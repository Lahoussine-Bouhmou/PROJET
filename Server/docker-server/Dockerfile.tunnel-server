FROM maven:3.9-eclipse-temurin-8 AS build
WORKDIR /src
COPY Server/tunnel-server/pom.xml ./
RUN mvn -q -DskipTests dependency:go-offline
COPY Server/tunnel-server/ ./
RUN mvn -q -DskipTests clean package

FROM eclipse-temurin:8-jre
WORKDIR /app
COPY --from=build /src/target/tunnel-server-1.0.0.jar ./tunnel-server.jar
ENV CONFIG_DIR=/tunnelConfig
EXPOSE 2201
CMD ["sh","-c","java -DconfigDir=${CONFIG_DIR} -jar /app/tunnel-server.jar"]
